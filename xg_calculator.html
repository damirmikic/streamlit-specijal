<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>xG Kalkulator - Merkur Specijal</title>
    <link rel="icon" type="image/png" href="merkur.png">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">

    <div class="container mx-auto p-4 md:p-8 max-w-6xl">
        <header class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800">xG Kalkulator</h1>
                    <p class="text-gray-600 mt-2">Unesite očekivane golove (xG) da biste izračunali detaljnu statistiku i kvote.</p>
                </div>
                <img src="merkur.png" alt="Merkur Logo" class="h-16">
            </div>
             <!-- Navigation Links -->
            <nav class="mt-4 border-t pt-4">
                <a href="index.html" class="text-blue-600 hover:underline font-medium mr-4">Glavna Stranica</a>
                <a href="match-specials.html" class="text-blue-600 hover:underline font-medium">Meč Specijali</a>
            </nav>
        </header>

        <main class="bg-white rounded-lg shadow-md p-6">
            <!-- xG Input Section -->
            <div>
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Unos xG Vrednosti</h2>
                <div id="xgInputContainer" class="space-y-3">
                    <!-- Initial Input Row is generated by JS -->
                </div>
            </div>

            <!-- Results Section -->
            <div id="resultsSection" class="mt-8 pt-6 border-t border-gray-200">
                <h2 class="text-2xl font-bold text-indigo-800 mb-4">Izračunati Rezultati i Kvote</h2>
                <div class="space-y-6">

                    <!-- Result Item: Total xG -->
                    <div class="bg-indigo-50 p-4 rounded-lg">
                        <div class="flex justify-between items-center">
                            <h3 class="font-semibold text-gray-700">Ukupan xG (Total xG):</h3>
                            <p id="totalXg" class="text-2xl font-bold text-indigo-600">0.00</p>
                        </div>
                        <div class="odds-calculator-container mt-3 pt-3 border-t border-indigo-200">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                                <div>
                                    <label for="margin-total" class="block text-xs font-medium text-gray-600">Margina (%)</label>
                                    <input type="number" id="margin-total" step="0.1" value="8.0" class="odds-input mt-1 block w-full py-1 px-2 border border-gray-300 rounded-md text-sm">
                                </div>
                                <div>
                                    <label for="line-total" class="block text-xs font-medium text-gray-600">Granica</label>
                                    <input type="number" id="line-total" step="0.5" value="2.5" class="odds-input mt-1 block w-full py-1 px-2 border border-gray-300 rounded-md text-sm">
                                </div>
                                <div class="grid grid-cols-2 gap-2 items-center bg-white p-2 rounded-md shadow-inner">
                                    <div class="text-center"><h4 class="text-xs font-semibold text-gray-600">VIŠE</h4><p id="over-total" class="font-bold text-green-600 text-lg">-</p></div>
                                    <div class="text-center"><h4 class="text-xs font-semibold text-gray-600">MANJE</h4><p id="under-total" class="font-bold text-red-600 text-lg">-</p></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Result Item: First Half xG -->
                     <div class="bg-indigo-50 p-4 rounded-lg">
                        <div class="flex justify-between items-center">
                            <h3 class="font-semibold text-gray-700">xG Prvo Poluvreme (44%):</h3>
                            <p id="firstHalfXg" class="text-2xl font-bold text-indigo-600">0.00</p>
                        </div>
                         <div class="odds-calculator-container mt-3 pt-3 border-t border-indigo-200">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                                <div><input type="number" id="margin-fh" step="0.1" value="8.0" class="odds-input w-full py-1 px-2 border rounded-md text-sm" placeholder="Margina %"></div>
                                <div><input type="number" id="line-fh" step="0.5" value="0.5" class="odds-input w-full py-1 px-2 border rounded-md text-sm" placeholder="Granica"></div>
                                <div class="grid grid-cols-2 gap-2 bg-white p-2 rounded-md shadow-inner">
                                    <div class="text-center"><p id="over-fh" class="font-bold text-green-600 text-lg">-</p></div>
                                    <div class="text-center"><p id="under-fh" class="font-bold text-red-600 text-lg">-</p></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Other result items follow the same pattern -->
                    <div class="bg-indigo-50 p-4 rounded-lg">
                        <div class="flex justify-between items-center"><h3 class="font-semibold text-gray-700">xG Drugo Poluvreme (56%):</h3><p id="secondHalfXg" class="text-2xl font-bold text-indigo-600">0.00</p></div>
                        <div class="odds-calculator-container mt-3 pt-3 border-t border-indigo-200"><div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end"><div><input type="number" id="margin-sh" step="0.1" value="8.0" class="odds-input w-full py-1 px-2 border rounded-md text-sm" placeholder="Margina %"></div><div><input type="number" id="line-sh" step="0.5" value="1.5" class="odds-input w-full py-1 px-2 border rounded-md text-sm" placeholder="Granica"></div><div class="grid grid-cols-2 gap-2 bg-white p-2 rounded-md shadow-inner"><div class="text-center"><p id="over-sh" class="font-bold text-green-600 text-lg">-</p></div><div class="text-center"><p id="under-sh" class="font-bold text-red-600 text-lg">-</p></div></div></div></div>
                    </div>

                    <div class="bg-indigo-50 p-4 rounded-lg">
                        <div class="flex justify-between items-center"><h3 class="font-semibold text-gray-700">xG do 10 min:</h3><p id="xg_10_min" class="text-2xl font-bold text-indigo-600">0.00</p></div>
                        <div class="odds-calculator-container mt-3 pt-3 border-t border-indigo-200"><div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end"><div><input type="number" id="margin-10" step="0.1" value="8.0" class="odds-input w-full py-1 px-2 border rounded-md text-sm" placeholder="Margina %"></div><div><input type="number" id="line-10" step="0.5" value="0.5" class="odds-input w-full py-1 px-2 border rounded-md text-sm" placeholder="Granica"></div><div class="grid grid-cols-2 gap-2 bg-white p-2 rounded-md shadow-inner"><div class="text-center"><p id="over-10" class="font-bold text-green-600 text-lg">-</p></div><div class="text-center"><p id="under-10" class="font-bold text-red-600 text-lg">-</p></div></div></div></div>
                    </div>

                    <div class="bg-indigo-50 p-4 rounded-lg">
                        <div class="flex justify-between items-center"><h3 class="font-semibold text-gray-700">xG do 15 min:</h3><p id="xg_15_min" class="text-2xl font-bold text-indigo-600">0.00</p></div>
                        <div class="odds-calculator-container mt-3 pt-3 border-t border-indigo-200"><div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end"><div><input type="number" id="margin-15" step="0.1" value="8.0" class="odds-input w-full py-1 px-2 border rounded-md text-sm" placeholder="Margina %"></div><div><input type="number" id="line-15" step="0.5" value="0.5" class="odds-input w-full py-1 px-2 border rounded-md text-sm" placeholder="Granica"></div><div class="grid grid-cols-2 gap-2 bg-white p-2 rounded-md shadow-inner"><div class="text-center"><p id="over-15" class="font-bold text-green-600 text-lg">-</p></div><div class="text-center"><p id="under-15" class="font-bold text-red-600 text-lg">-</p></div></div></div></div>
                    </div>

                     <div class="bg-indigo-50 p-4 rounded-lg">
                        <div class="flex justify-between items-center"><h3 class="font-semibold text-gray-700">xG do 30 min:</h3><p id="xg_30_min" class="text-2xl font-bold text-indigo-600">0.00</p></div>
                        <div class="odds-calculator-container mt-3 pt-3 border-t border-indigo-200"><div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end"><div><input type="number" id="margin-30" step="0.1" value="8.0" class="odds-input w-full py-1 px-2 border rounded-md text-sm" placeholder="Margina %"></div><div><input type="number" id="line-30" step="0.5" value="0.5" class="odds-input w-full py-1 px-2 border rounded-md text-sm" placeholder="Granica"></div><div class="grid grid-cols-2 gap-2 bg-white p-2 rounded-md shadow-inner"><div class="text-center"><p id="over-30" class="font-bold text-green-600 text-lg">-</p></div><div class="text-center"><p id="under-30" class="font-bold text-red-600 text-lg">-</p></div></div></div></div>
                    </div>

                    <div class="bg-indigo-50 p-4 rounded-lg">
                        <div class="flex justify-between items-center"><h3 class="font-semibold text-gray-700">xG od 15 do 45 min:</h3><p id="xg_15_45_min" class="text-2xl font-bold text-indigo-600">0.00</p></div>
                        <div class="odds-calculator-container mt-3 pt-3 border-t border-indigo-200"><div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end"><div><input type="number" id="margin-1545" step="0.1" value="8.0" class="odds-input w-full py-1 px-2 border rounded-md text-sm" placeholder="Margina %"></div><div><input type="number" id="line-1545" step="0.5" value="0.5" class="odds-input w-full py-1 px-2 border rounded-md text-sm" placeholder="Granica"></div><div class="grid grid-cols-2 gap-2 bg-white p-2 rounded-md shadow-inner"><div class="text-center"><p id="over-1545" class="font-bold text-green-600 text-lg">-</p></div><div class="text-center"><p id="under-1545" class="font-bold text-red-600 text-lg">-</p></div></div></div></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const xgInputContainer = document.getElementById('xgInputContainer');
            
            // --- Helper Functions for Poisson Calculation ---
            const factorial = (n) => {
                if (n < 0 || n > 170) return Infinity; 
                if (n === 0) return 1;
                let r = 1; for (let i = 2; i <= n; i++) r *= i; return r;
            };

            const poissonProbability = (lambda, k) => {
                const factK = factorial(k);
                if (factK === Infinity) return 0;
                return (Math.pow(lambda, k) * Math.exp(-lambda)) / factK;
            };
            
            const createXgRow = () => {
                const row = document.createElement('div');
                row.className = 'xg-row grid grid-cols-1 sm:grid-cols-[1fr,1fr,1fr,auto] gap-4 items-end p-3 bg-gray-50 rounded-md';
                row.innerHTML = `
                    <div><label class="block text-sm font-medium text-gray-700">Domaćin xG</label><input type="number" step="0.01" class="home-xg-input mt-1 block w-full py-2 px-3 border border-gray-300 rounded-md shadow-sm" placeholder="npr. 1.5"></div>
                    <div><label class="block text-sm font-medium text-gray-700">Gost xG</label><input type="number" step="0.01" class="away-xg-input mt-1 block w-full py-2 px-3 border border-gray-300 rounded-md shadow-sm" placeholder="npr. 1.2"></div>
                    <div><label class="block text-sm font-medium text-gray-700">Ukupno xG</label><input type="number" step="0.01" class="total-xg-input mt-1 block w-full py-2 px-3 border border-gray-300 rounded-md shadow-sm" placeholder="npr. 2.7"></div>
                    <div class="flex gap-2">
                        <button class="add-xg-row bg-blue-500 hover:bg-blue-600 text-white font-bold h-10 w-10 rounded-lg flex items-center justify-center text-xl">+</button>
                        <button class="remove-xg-row bg-red-500 hover:bg-red-600 text-white font-bold h-10 w-10 rounded-lg flex items-center justify-center text-xl">-</button>
                    </div>
                `;
                return row;
            };

            const calculateOddsFor = (id, xgValue) => {
                const marginEl = document.getElementById(`margin-${id}`);
                const lineEl = document.getElementById(`line-${id}`);
                const overEl = document.getElementById(`over-${id}`);
                const underEl = document.getElementById(`under-${id}`);
                
                const margin = parseFloat(marginEl.value) || 0;
                const line = parseFloat(lineEl.value);

                if (xgValue <= 0 || isNaN(line) || line < 0) {
                    overEl.textContent = '-'; underEl.textContent = '-'; return;
                }

                let probUnder = 0;
                const maxGoals = Math.floor(line);
                for (let k = 0; k <= maxGoals; k++) probUnder += poissonProbability(xgValue, k);
                
                let probOver = 1 - probUnder;
                probUnder = Math.max(0.0001, Math.min(0.9999, probUnder));
                probOver = Math.max(0.0001, Math.min(0.9999, probOver));

                const marginFactor = 1 + (margin / 100);
                overEl.textContent = ( (1 / probOver) / marginFactor ).toFixed(2);
                underEl.textContent = ( (1 / probUnder) / marginFactor ).toFixed(2);
            };

            const calculateAll = () => {
                const rows = document.querySelectorAll('.xg-row');
                let totalXg = 0;
                rows.forEach(row => {
                    totalXg += (parseFloat(row.querySelector('.home-xg-input').value) || 0);
                    totalXg += (parseFloat(row.querySelector('.away-xg-input').value) || 0);
                    totalXg += (parseFloat(row.querySelector('.total-xg-input').value) || 0);
                });
                
                const firstHalfXg = totalXg * 0.44;
                const xg_per_minute_fh = firstHalfXg / 45;
                const results = {
                    total: totalXg,
                    fh: firstHalfXg,
                    sh: totalXg * 0.56,
                    '10': xg_per_minute_fh * 10,
                    '15': xg_per_minute_fh * 15,
                    '30': xg_per_minute_fh * 30,
                    '1545': xg_per_minute_fh * 30
                };
                
                // Update text content
                document.getElementById('totalXg').textContent = results.total.toFixed(2);
                document.getElementById('firstHalfXg').textContent = results.fh.toFixed(2);
                document.getElementById('secondHalfXg').textContent = results.sh.toFixed(2);
                document.getElementById('xg_10_min').textContent = results['10'].toFixed(2);
                document.getElementById('xg_15_min').textContent = results['15'].toFixed(2);
                document.getElementById('xg_30_min').textContent = results['30'].toFixed(2);
                document.getElementById('xg_15_45_min').textContent = results['1545'].toFixed(2);

                // Update all odds sections
                for (const key in results) {
                    calculateOddsFor(key, results[key]);
                }
            };
            
            // Event Delegation for adding/removing rows and input changes
            xgInputContainer.addEventListener('click', (e) => {
                const target = e.target.closest('button');
                if (!target) return;

                if (target.classList.contains('add-xg-row')) {
                    const newRow = createXgRow();
                    target.closest('.xg-row').insertAdjacentElement('afterend', newRow);
                } else if (target.classList.contains('remove-xg-row')) {
                    if (document.querySelectorAll('.xg-row').length > 1) {
                        target.closest('.xg-row').remove();
                    }
                }
                calculateAll();
            });

            xgInputContainer.addEventListener('input', calculateAll);
            document.getElementById('resultsSection').addEventListener('input', (e) => {
                 if(e.target.classList.contains('odds-input')) {
                    calculateAll();
                 }
            });

            // Initial setup
            xgInputContainer.appendChild(createXgRow());
            calculateAll();
        });
    </script>
</body>
</html>

